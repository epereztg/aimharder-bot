name: AimHarder Bot WZ

on:
  schedule:
    # Runs daily at 5:45 AM UTC - starts early to be ready when bookings open
    # The script will wait until 18:30 Madrid time (handles DST automatically)
    # CRON CALCULATION / TIMEZONE EXPLANATION:
    # GitHub Actions always runs in UTC. Madrid is UTC+1 in Winter and UTC+2 in Summer.
    # To ensure the script ALWAYS runs before the target time (e.g. 15 mins before), 
    # you must calculate the cron based on Summer time (UTC+2), which is the "earlier" UTC time.
    # 
    # Example for 18:30 Madrid Target:
    # - Summer (UTC+2): 18:30 Madrid = 16:30 UTC. Trigger 15m before = 16:15 UTC.
    # - Winter (UTC+1): 18:30 Madrid = 17:30 UTC. Trigger at 16:15 UTC will be 17:15 Madrid (1h 15m wait).
    #
    # If you calculated based on Winter (17:15 UTC), in Summer it would run at 19:15 Madrid (too late!).
    # So: Always configure cron for Summer UTC equivalent minus 15 mins.
    - cron: '15 16 * * *'

jobs:
  book:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run booking script
        env:
          EMAIL: ${{ secrets.EMAIL }}
          PASSWORD: ${{ secrets.PASSWORD }}
          # Configure the target booking time here (Madrid time)
          TARGET_HOUR: 18
          TARGET_MINUTE: 30
          # Telegram Notifications
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ðŸš€ Processing Box 10002..."
          python main.py --days-ahead 2 --schedule schedule_10002.json

