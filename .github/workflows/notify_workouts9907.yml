name: Workout Notifications LCL

on:
  schedule:
    - cron: "0 21 * 1,2,11,12 *"   # Winter (22:00 Madrid) - Daily
    - cron: "0 20 * 3-10 *"        # Summer (22:00 Madrid) - Daily
  workflow_dispatch:              # Manual trigger

env:
  IMAGE: ghcr.io/epereztg/aimharder-bot:latest

jobs:
  notify:
    runs-on: ubuntu-latest
    permissions:
      packages: read

    steps:
      - name: Log in to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Run notification script
        env:
          EMAIL: ${{ secrets.EMAIL }}
          PASSWORD: ${{ secrets.PASSWORD }}
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ðŸš€ Sending notifications for laucalahealthcrossfit..."
          docker run --rm \
            -e EMAIL -e PASSWORD \
            -e TELEGRAM_TOKEN -e TELEGRAM_CHAT_ID \
            ${{ env.IMAGE }} \
            python notify_workouts.py --box-name laucalahealthcrossfit --days-ahead 1
